<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden University - Gestión de Alumnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #2c3e50, #34495e) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin: 30px 0;
        }
        .content-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .table th {
            background: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #2c3e50;
        }
        .action-buttons .btn {
            margin: 0 2px;
            border-radius: 8px;
        }
        .alert {
            border-radius: 15px;
            border: none;
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #e0e6ed;
            padding: 10px 15px;
        }
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
            border-color: #667eea;
        }
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
            border: none;
        }
        .student-info {
            font-size: 0.85rem;
        }
        .table-responsive {
            border-radius: 15px;
        }
        .stats-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .tab-content {
            padding: 20px;
        }
        .nav-tabs .nav-link {
            border-radius: 10px 10px 0 0;
            border: none;
            margin-right: 5px;
        }
        .nav-tabs .nav-link.active {
            background: #667eea;
            color: white;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .page-header {
                margin: 15px 0;
                border-radius: 15px;
            }
            .page-header h1 {
                font-size: 1.5rem;
            }
            .content-card {
                margin: 10px 0;
                border-radius: 15px;
            }
            .btn {
                font-size: 0.85rem;
                padding: 8px 15px;
            }
            .table {
                font-size: 0.85rem;
            }
            .action-buttons .btn {
                padding: 5px 8px;
                margin: 1px;
            }
            .modal-dialog {
                margin: 0.5rem;
            }
            .stats-card {
                margin-bottom: 15px;
            }
            .nav-tabs {
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 576px) {
            body {
                padding: 5px;
            }
            .container-fluid {
                padding: 10px;
            }
            .page-header {
                margin: 10px 0;
                padding: 15px;
            }
            .page-header h1 {
                font-size: 1.3rem;
            }
            .content-card {
                padding: 15px;
            }
            .btn {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            .table {
                font-size: 0.8rem;
            }
            .action-buttons .btn {
                padding: 4px 6px;
                margin: 1px 0;
            }
            .modal-header h4 {
                font-size: 1.1rem;
            }
            .form-control, .form-select {
                font-size: 16px; /* Evita zoom en iOS */
            }
            .d-flex.justify-content-between {
                flex-direction: column;
                gap: 10px;
            }
            .d-flex.justify-content-between > * {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/dashboard">
                <i class="fas fa-university me-2"></i>
                Garden University
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-user-circle me-1"></i>
                    <span th:text="${userEmail}"></span>
                </span>
                <a class="btn btn-outline-light btn-sm" href="/logout">
                    <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesión
                </a>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <!-- Page Header -->
        <div class="page-header p-4 text-center">
            <h1 class="mb-2">
                <i class="fas fa-graduation-cap me-3"></i>
                Gestión de Alumnos
            </h1>
            <p class="mb-0">Sistema integral para administrar la información estudiantil</p>
        </div>

        <!-- Alerts -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Stats Card -->
        <div class="stats-card p-3 mb-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-1"><i class="fas fa-users me-2"></i>Total de Alumnos Activos</h5>
                    <h3 class="mb-0" th:text="${totalStudents ?: 0}">0</h3>
                </div>
                <div class="col-md-6 text-end">
                    <button class="btn btn-light btn-lg" data-bs-toggle="modal" data-bs-target="#studentModal">
                        <i class="fas fa-plus me-2"></i>Nuevo Alumno
                    </button>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="content-card p-3 mb-4">
            <form method="get" action="/alumnos">
                <div class="row align-items-end">
                    <div class="col-md-8">
                        <label for="search" class="form-label">Buscar Alumno</label>
                        <input type="text" class="form-control" id="search" name="search" 
                               th:value="${search}" placeholder="Buscar por nombre, apellidos, CURP o correo...">
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-search me-1"></i>Buscar
                        </button>
                        <a href="/alumnos" class="btn btn-outline-secondary">
                            <i class="fas fa-refresh me-1"></i>Limpiar
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Students Table -->
        <div class="content-card p-3">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Nombre Completo</th>
                            <th>CURP</th>
                            <th>Programa</th>
                            <th>Modalidad</th>
                            <th>Cuatrimestre</th>
                            <th>Celular</th>
                            <th>Correo Institucional</th>
                            <th>Estado de Pago</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="student : ${students}" th:if="${students != null and !students.empty}">
                            <td>
                                <strong th:text="${student.nombres + ' ' + student.apellidos}"></strong>
                                <br>
                                <small class="text-muted student-info" 
                                       th:text="${(student.genero ?: 'No especificado') + ' • ' + (student.estadoCivil ?: 'No especificado')}"></small>
                            </td>
                            <td>
                                <span th:text="${student.curp ?: 'No registrado'}" 
                                      th:class="${student.curp != null ? '' : 'text-muted'}"></span>
                                <br>
                                <small class="text-muted student-info" 
                                       th:text="${student.rfc ?: 'No registrado'}"></small>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:class="${student.programaEstudios != null ? 'bg-info' : 'bg-secondary'}"
                                      th:text="${student.programaEstudios ?: 'No asignado'}"></span>
                                <br>
                                <small class="text-muted" th:text="${'Edad: ' + (student.edad ?: 'N/A')}"></small>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:class="${student.modalidadEstudios != null ? 'bg-success' : 'bg-secondary'}"
                                      th:text="${student.modalidadEstudios ?: 'No asignada'}"></span>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:class="${student.cuatrimestre != null ? 'bg-primary' : 'bg-secondary'}"
                                      th:text="${student.cuatrimestre ?: 'No asignado'}"></span>
                            </td>
                            <td>
                                <span th:text="${student.celular ?: 'No registrado'}"
                                      th:class="${student.celular != null ? '' : 'text-muted'}"></span>
                                <br th:if="${student.celularEmergencia != null}">
                                <small class="text-muted student-info" th:if="${student.celularEmergencia != null}">
                                    <i class="fas fa-phone-alt me-1"></i>
                                    <span th:text="${student.celularEmergencia}"></span>
                                </small>
                                <small class="text-muted student-info" th:unless="${student.celularEmergencia != null}">
                                    <i class="fas fa-phone-alt me-1"></i>No registrado
                                </small>
                            </td>
                            <td>
                                <span th:text="${student.correoInstitucional}"></span>
                            </td>
                            <td>
                                <span th:if="${student.conceptoPago != null}" class="badge bg-success">
                                    <span th:text="${student.conceptoPago}"></span>
                                </span>
                                <span th:unless="${student.conceptoPago != null}" class="badge bg-warning">
                                    Sin registro
                                </span>
                                <br th:if="${student.montoPago != null}">
                                <small th:if="${student.montoPago != null}" class="text-muted student-info">
                                    $<span th:text="${#numbers.formatDecimal(student.montoPago, 1, 2)}"></span>
                                </small>
                            </td>
                            <td class="text-center">
                                <div class="action-buttons">
                                    <button class="btn btn-success btn-sm" onclick="editStudent(this)" 
                                            th:data-student="${student.id}" title="Editar alumno">
                                        <i class="fas fa-edit me-1"></i>Editar
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="viewStudent(this)" 
                                            th:data-student="${student.id}" title="Ver detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteStudent(this)" 
                                            th:data-student="${student.id}" th:data-name="${student.nombres + ' ' + student.apellidos}"
                                            title="Desactivar alumno">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${students == null or students.empty}">
                            <td colspan="8" class="text-center py-4">
                                <div class="text-muted">
                                    <i class="fas fa-users fa-3x mb-3 d-block"></i>
                                    <h5>No hay alumnos registrados</h5>
                                    <p>Haz clic en "Nuevo Alumno" para comenzar a registrar estudiantes.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Back to Dashboard -->
        <div class="text-center mt-4">
            <a href="/dashboard" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>Volver al Dashboard
            </a>
        </div>
    </div>

    <!-- Student Modal -->
    <div class="modal fade" id="studentModal" tabindex="-1" aria-labelledby="studentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentModalLabel">
                        <i class="fas fa-user-plus me-2"></i>Registrar Nuevo Alumno
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="studentForm" method="post" action="/alumnos/save">
                    <div class="modal-body">
                        <ul class="nav nav-tabs" id="studentTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal" type="button" role="tab">
                                    <i class="fas fa-user me-1"></i>Datos Personales
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab">
                                    <i class="fas fa-address-book me-1"></i>Contacto
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="academic-tab" data-bs-toggle="tab" data-bs-target="#academic" type="button" role="tab">
                                    <i class="fas fa-graduation-cap me-1"></i>Académico
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="payment-tab" data-bs-toggle="tab" data-bs-target="#payment" type="button" role="tab">
                                    <i class="fas fa-credit-card me-1"></i>Pagos
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="studentTabContent">
                            <!-- Datos Personales -->
                            <div class="tab-pane fade show active" id="personal" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="nombres" class="form-label">Nombres *</label>
                                        <input type="text" class="form-control" id="nombres" name="nombres" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="apellidos" class="form-label">Apellidos *</label>
                                        <input type="text" class="form-control" id="apellidos" name="apellidos" required>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="edad" class="form-label">Edad</label>
                                        <input type="number" class="form-control" id="edad" name="edad" min="15" max="80">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control" id="fechaNacimiento" name="fechaNacimiento">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="genero" class="form-label">Género</label>
                                        <select class="form-select" id="genero" name="genero">
                                            <option value="">Seleccionar...</option>
                                            <option value="Masculino">Masculino</option>
                                            <option value="Femenino">Femenino</option>
                                            <option value="Otro">Otro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="estadoCivil" class="form-label">Estado Civil</label>
                                        <select class="form-select" id="estadoCivil" name="estadoCivil">
                                            <option value="">Seleccionar...</option>
                                            <option value="Soltero(a)">Soltero(a)</option>
                                            <option value="Casado(a)">Casado(a)</option>
                                            <option value="Divorciado(a)">Divorciado(a)</option>
                                            <option value="Viudo(a)">Viudo(a)</option>
                                            <option value="Unión libre">Unión libre</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="nombrePadreTutor" class="form-label">Nombre del Padre o Tutor</label>
                                        <input type="text" class="form-control" id="nombrePadreTutor" name="nombrePadreTutor">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="curp" class="form-label">CURP</label>
                                        <input type="text" class="form-control" id="curp" name="curp" maxlength="18" 
                                               pattern="[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9]{2}" 
                                               placeholder="AAAA000000HAAAAN00">
                                        <div class="form-text">Formato: AAAA000000HAAAAN00 (opcional)</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="rfc" class="form-label">RFC</label>
                                        <input type="text" class="form-control" id="rfc" name="rfc" maxlength="13" 
                                               pattern="[A-Z]{4}[0-9]{6}[A-Z0-9]{3}" 
                                               placeholder="AAAA000000AAA">
                                        <div class="form-text">Formato: AAAA000000AAA (opcional)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contacto -->
                            <div class="tab-pane fade" id="contact" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label for="domicilio" class="form-label">Domicilio</label>
                                        <textarea class="form-control" id="domicilio" name="domicilio" rows="3" 
                                                  placeholder="Calle, número, colonia, ciudad, estado, código postal"></textarea>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="celular" class="form-label">Celular</label>
                                        <input type="tel" class="form-control" id="celular" name="celular" 
                                               pattern="[0-9]{10}" placeholder="5555555555">
                                        <div class="form-text">10 dígitos sin espacios</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="celularEmergencia" class="form-label">Celular de Emergencia</label>
                                        <input type="tel" class="form-control" id="celularEmergencia" name="celularEmergencia" 
                                               pattern="[0-9]{10}" placeholder="5555555555">
                                        <div class="form-text">10 dígitos sin espacios</div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="correoInstitucional" class="form-label">Correo Institucional *</label>
                                        <input type="email" class="form-control" id="correoInstitucional" name="correoInstitucional" 
                                               placeholder="estudiante@garden.uni.edu" pattern=".*@garden\.uni\.edu" required>
                                        <div class="form-text">Debe terminar en @garden.uni.edu</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="passwordAcceso" class="form-label">
                                            <i class="fas fa-key me-1"></i>Contraseña de Acceso *
                                        </label>
                                        <input type="password" class="form-control" id="passwordAcceso" name="passwordAcceso" 
                                               placeholder="Contraseña para acceder al sistema" minlength="6" required>
                                        <div class="form-text">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Mínimo 6 caracteres. El estudiante usará esta contraseña para acceder al sistema.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Académico -->
                            <div class="tab-pane fade" id="academic" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="programaEstudios" class="form-label">Programa de Estudios *</label>
                                        <select class="form-select" id="programaEstudios" name="programaEstudios">
                                            <option value="">Seleccionar programa...</option>
                                            <option th:each="programa : ${programasEstudio}" 
                                                    th:value="${programa}" 
                                                    th:text="${programa}"></option>
                                        </select>
                                        <div class="form-text">Nivel académico que está cursando</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="modalidadEstudios" class="form-label">Modalidad de Estudios *</label>
                                        <select class="form-select" id="modalidadEstudios" name="modalidadEstudios">
                                            <option value="">Seleccionar modalidad...</option>
                                            <option th:each="modalidad : ${modalidadesEstudio}" 
                                                    th:value="${modalidad}" 
                                                    th:text="${modalidad}"></option>
                                        </select>
                                        <div class="form-text">Modalidad en la que estudia</div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <label for="cuatrimestre" class="form-label">Cuatrimestre</label>
                                        <select class="form-select" id="cuatrimestre" name="cuatrimestre">
                                            <option value="">Seleccionar cuatrimestre...</option>
                                            <option value="1er Cuatrimestre">1er Cuatrimestre</option>
                                            <option value="2do Cuatrimestre">2do Cuatrimestre</option>
                                            <option value="3er Cuatrimestre">3er Cuatrimestre</option>
                                            <option value="4to Cuatrimestre">4to Cuatrimestre</option>
                                            <option value="5to Cuatrimestre">5to Cuatrimestre</option>
                                            <option value="6to Cuatrimestre">6to Cuatrimestre</option>
                                            <option value="7mo Cuatrimestre">7mo Cuatrimestre</option>
                                            <option value="8vo Cuatrimestre">8vo Cuatrimestre</option>
                                            <option value="9no Cuatrimestre">9no Cuatrimestre</option>
                                            <option value="10mo Cuatrimestre">10mo Cuatrimestre</option>
                                        </select>
                                        <div class="form-text">Cuatrimestre que está cursando actualmente</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pagos -->
                            <div class="tab-pane fade" id="payment" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label for="conceptoPago" class="form-label">Concepto del Pago</label>
                                        <select class="form-select" id="conceptoPago" name="conceptoPago">
                                            <option value="">Seleccionar concepto...</option>
                                            <option value="Colegiatura">Colegiatura</option>
                                            <option value="Inscripción">Inscripción</option>
                                            <option value="Examen extraordinario">Examen extraordinario</option>
                                            <option value="Materiales">Materiales</option>
                                            <option value="Laboratorio">Laboratorio</option>
                                            <option value="Graduación">Graduación</option>
                                            <option value="Credencial">Credencial</option>
                                            <option value="Constancia">Constancia</option>
                                            <option value="Otro">Otro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="montoPago" class="form-label">Monto del Pago</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="montoPago" name="montoPago" 
                                                   step="0.01" min="0" placeholder="0.00">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="metodoPago" class="form-label">Método de Pago</label>
                                        <select class="form-select" id="metodoPago" name="metodoPago">
                                            <option value="">Seleccionar método...</option>
                                            <option value="Efectivo">Efectivo</option>
                                            <option value="Tarjeta de débito">Tarjeta de débito</option>
                                            <option value="Tarjeta de crédito">Tarjeta de crédito</option>
                                            <option value="Transferencia bancaria">Transferencia bancaria</option>
                                            <option value="Depósito bancario">Depósito bancario</option>
                                            <option value="Cheque">Cheque</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Guardar Alumno
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Student Modal -->
    <div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewStudentModalLabel">
                        <i class="fas fa-user-circle me-2"></i>Información del Alumno
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="studentViewContent">
                    <!-- Content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro de que deseas desactivar a este alumno?</p>
                    <p><strong id="deleteStudentName"></strong></p>
                    <p class="text-muted small">Esta acción desactivará al estudiante pero no eliminará sus datos permanentemente.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <form id="deleteForm" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash me-1"></i>Desactivar Alumno
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Auto-close alerts after 5 seconds
        setTimeout(function() {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);

        // Calculate age based on birth date
        document.getElementById('fechaNacimiento').addEventListener('change', function() {
            const birthDate = new Date(this.value);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            if (age >= 0 && age <= 100) {
                document.getElementById('edad').value = age;
            }
        });

        // Format CURP to uppercase
        document.getElementById('curp').addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });

        // Format RFC to uppercase
        document.getElementById('rfc').addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });

        // View student function
        function viewStudent(button) {
            const studentId = button.getAttribute('data-student');
            
            fetch(`/alumnos/edit/${studentId}`)
                .then(response => response.json())
                .then(student => {
                    const content = `
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary"><i class="fas fa-user me-2"></i>Información Personal</h6>
                                <table class="table table-sm">
                                    <tr><td><strong>Nombre completo:</strong></td><td>${student.nombres} ${student.apellidos}</td></tr>
                                    <tr><td><strong>Edad:</strong></td><td>${student.edad || 'No registrada'} ${student.edad ? 'años' : ''}</td></tr>
                                    <tr><td><strong>Fecha de nacimiento:</strong></td><td>${student.fechaNacimiento || 'No registrada'}</td></tr>
                                    <tr><td><strong>Género:</strong></td><td>${student.genero || 'No especificado'}</td></tr>
                                    <tr><td><strong>Estado civil:</strong></td><td>${student.estadoCivil || 'No especificado'}</td></tr>
                                    <tr><td><strong>CURP:</strong></td><td>${student.curp || 'No registrado'}</td></tr>
                                    <tr><td><strong>RFC:</strong></td><td>${student.rfc || 'No registrado'}</td></tr>
                                    <tr><td><strong>Padre/Tutor:</strong></td><td>${student.nombrePadreTutor || 'No registrado'}</td></tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary"><i class="fas fa-address-book me-2"></i>Contacto</h6>
                                <table class="table table-sm">
                                    <tr><td><strong>Domicilio:</strong></td><td>${student.domicilio || 'No registrado'}</td></tr>
                                    <tr><td><strong>Celular:</strong></td><td>${student.celular || 'No registrado'}</td></tr>
                                    <tr><td><strong>Celular emergencia:</strong></td><td>${student.celularEmergencia || 'No registrado'}</td></tr>
                                    <tr><td><strong>Correo institucional:</strong></td><td>${student.correoInstitucional}</td></tr>
                                    <tr><td><strong>Contraseña de acceso:</strong></td><td>
                                        ${student.passwordAcceso ? '<span class="text-success"><i class="fas fa-check-circle me-1"></i>Configurada</span>' : '<span class="text-warning"><i class="fas fa-exclamation-triangle me-1"></i>No configurada</span>'}
                                    </td></tr>
                                </table>
                                
                                <h6 class="text-primary mt-3"><i class="fas fa-graduation-cap me-2"></i>Información Académica</h6>
                                <table class="table table-sm">
                                    <tr><td><strong>Programa de estudios:</strong></td><td>${student.programaEstudios ? `<span class="badge bg-info">${student.programaEstudios}</span>` : '<span class="badge bg-secondary">No asignado</span>'}</td></tr>
                                    <tr><td><strong>Modalidad de estudios:</strong></td><td>${student.modalidadEstudios ? `<span class="badge bg-success">${student.modalidadEstudios}</span>` : '<span class="badge bg-secondary">No asignada</span>'}</td></tr>
                                    <tr><td><strong>Cuatrimestre:</strong></td><td>${student.cuatrimestre ? `<span class="badge bg-primary">${student.cuatrimestre}</span>` : '<span class="badge bg-secondary">No asignado</span>'}</td></tr>
                                </table>
                                
                                ${student.conceptoPago ? `
                                <h6 class="text-primary mt-3"><i class="fas fa-credit-card me-2"></i>Información de Pago</h6>
                                <table class="table table-sm">
                                    <tr><td><strong>Concepto:</strong></td><td>${student.conceptoPago}</td></tr>
                                    <tr><td><strong>Monto:</strong></td><td>$${student.montoPago ? student.montoPago.toFixed(2) : '0.00'}</td></tr>
                                    <tr><td><strong>Método:</strong></td><td>${student.metodoPago || 'No especificado'}</td></tr>
                                </table>
                                ` : '<p class="text-muted mt-3">No hay información de pagos registrada.</p>'}
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('studentViewContent').innerHTML = content;
                    new bootstrap.Modal(document.getElementById('viewStudentModal')).show();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar la información del estudiante');
                });
        }

        // Edit student function
        function editStudent(button) {
            const studentId = button.getAttribute('data-student');
            
            fetch(`/alumnos/edit/${studentId}`)
                .then(response => response.json())
                .then(student => {
                    // Fill form with student data
                    document.getElementById('nombres').value = student.nombres;
                    document.getElementById('apellidos').value = student.apellidos;
                    document.getElementById('edad').value = student.edad;
                    document.getElementById('fechaNacimiento').value = student.fechaNacimiento;
                    document.getElementById('genero').value = student.genero;
                    document.getElementById('estadoCivil').value = student.estadoCivil;
                    document.getElementById('curp').value = student.curp;
                    document.getElementById('rfc').value = student.rfc;
                    document.getElementById('domicilio').value = student.domicilio;
                    document.getElementById('celular').value = student.celular;
                    document.getElementById('celularEmergencia').value = student.celularEmergencia;
                    document.getElementById('correoInstitucional').value = student.correoInstitucional;
                    document.getElementById('passwordAcceso').value = student.passwordAcceso || '';
                    document.getElementById('programaEstudios').value = student.programaEstudios || '';
                    document.getElementById('modalidadEstudios').value = student.modalidadEstudios || '';
                    document.getElementById('cuatrimestre').value = student.cuatrimestre;
                    document.getElementById('conceptoPago').value = student.conceptoPago || '';
                    document.getElementById('montoPago').value = student.montoPago || '';
                    document.getElementById('metodoPago').value = student.metodoPago || '';
                    document.getElementById('nombrePadreTutor').value = student.nombrePadreTutor;
                    
                    // Change form action and modal title
                    document.getElementById('studentForm').action = `/alumnos/update/${studentId}`;
                    document.getElementById('studentModalLabel').innerHTML = '<i class="fas fa-user-edit me-2"></i>Editar Alumno';
                    
                    // Show modal
                    new bootstrap.Modal(document.getElementById('studentModal')).show();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar la información del estudiante');
                });
        }

        // Delete student function
        function deleteStudent(button) {
            const studentId = button.getAttribute('data-student');
            const studentName = button.getAttribute('data-name');
            
            document.getElementById('deleteStudentName').textContent = studentName;
            document.getElementById('deleteForm').action = `/alumnos/delete/${studentId}`;
            
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // Reset modal when closed
        document.getElementById('studentModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('studentForm').reset();
            document.getElementById('studentForm').action = '/alumnos/save';
            document.getElementById('studentModalLabel').innerHTML = '<i class="fas fa-user-plus me-2"></i>Registrar Nuevo Alumno';
            
            // Reset to first tab
            document.querySelector('#personal-tab').click();
        });
    </script>
</body>
</html>
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/dashboard"><i class="fas fa-university me-2"></i>Garden University</a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-user me-2"></i>
                    <span th:text="${userEmail}"></span>
                </span>
                <a href="/logout" class="btn btn-outline-light">
                    <i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="card page-header">
            <div class="card-body text-center py-4">
                <h1><i class="fas fa-graduation-cap me-3"></i>Gestión de Alumnos</h1>
                <p class="lead mb-0">Administración de estudiantes y expedientes académicos</p>
            </div>
        </div>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard"><i class="fas fa-home"></i> Inicio</a></li>
                <li class="breadcrumb-item active">Alumnos</li>
            </ol>
        </nav>

        <!-- Content -->
        <div class="card content-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>Lista de Estudiantes</h5>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                    <i class="fas fa-plus me-2"></i>Agregar Estudiante
                </button>
            </div>
            <div class="card-body">
                <!-- Search and Filters -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" placeholder="Buscar estudiante...">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select">
                            <option>Todas las Carreras</option>
                            <option>Ingeniería de Sistemas</option>
                            <option>Medicina</option>
                            <option>Derecho</option>
                            <option>Administración</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select">
                            <option>Todos los Estados</option>
                            <option>Activo</option>
                            <option>Inactivo</option>
                            <option>Graduado</option>
                        </select>
                    </div>
                </div>

                <!-- Students Table -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre Completo</th>
                                <th>Email</th>
                                <th>Carrera</th>
                                <th>Semestre</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>EST001</td>
                                <td>Juan Pérez García</td>
                                <td>juan.perez@estudiante.garden.uni.edu</td>
                                <td>Ingeniería de Sistemas</td>
                                <td>6°</td>
                                <td><span class="badge bg-success">Activo</span></td>
                                <td class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary" title="Ver Detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" title="Expediente">
                                        <i class="fas fa-file-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>EST002</td>
                                <td>María González López</td>
                                <td>maria.gonzalez@estudiante.garden.uni.edu</td>
                                <td>Medicina</td>
                                <td>3°</td>
                                <td><span class="badge bg-success">Activo</span></td>
                                <td class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary" title="Ver Detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" title="Expediente">
                                        <i class="fas fa-file-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>EST003</td>
                                <td>Carlos Rodríguez Méndez</td>
                                <td>carlos.rodriguez@estudiante.garden.uni.edu</td>
                                <td>Derecho</td>
                                <td>8°</td>
                                <td><span class="badge bg-warning">En Proceso de Graduación</span></td>
                                <td class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary" title="Ver Detalles">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" title="Expediente">
                                        <i class="fas fa-file-alt"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <nav>
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <span class="page-link">Anterior</span>
                        </li>
                        <li class="page-item active">
                            <span class="page-link">1</span>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">Siguiente</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal fade" id="addStudentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Agregar Nuevo Estudiante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombres</label>
                                <input type="text" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Apellidos</label>
                                <input type="text" class="form-control" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" placeholder="@estudiante.garden.uni.edu" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Teléfono</label>
                                <input type="tel" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Carrera</label>
                                <select class="form-select" required>
                                    <option value="">Seleccionar carrera...</option>
                                    <option>Ingeniería de Sistemas</option>
                                    <option>Medicina</option>
                                    <option>Derecho</option>
                                    <option>Administración</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Semestre</label>
                                <select class="form-select" required>
                                    <option value="">Seleccionar semestre...</option>
                                    <option>1°</option>
                                    <option>2°</option>
                                    <option>3°</option>
                                    <option>4°</option>
                                    <option>5°</option>
                                    <option>6°</option>
                                    <option>7°</option>
                                    <option>8°</option>
                                    <option>9°</option>
                                    <option>10°</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary">Guardar Estudiante</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
